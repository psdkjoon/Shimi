<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آزمون حفظ کردن - تعاملی</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
            margin: 20px;
            direction: rtl;
            text-align: right;
        }
        .container {
            max-width: 700px;
            margin: 30px auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 {
            color: #0056b3;
            margin-bottom: 25px;
        }
        .qa-box {
            background-color: #e9f7ff;
            border: 1px solid #cce7ff;
            border-radius: 6px;
            padding: 25px;
            margin-bottom: 20px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .question-text {
            font-size: 1.4em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 20px;
            text-align: center;
        }
        input[type="text"] {
            width: 80%;
            padding: 10px 15px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1.1em;
            text-align: center; /* Center align input text */
        }
        .buttons {
            margin-top: 15px;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 0 5px;
        }
        button:hover {
            background-color: #218838;
        }
        button#checkAnswer {
            background-color: #007bff;
        }
        button#checkAnswer:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .feedback {
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: bold;
        }
        .feedback.correct {
            color: #28a745;
        }
        .feedback.incorrect {
            color: #dc3545;
        }
        .correct-answer-display {
            margin-top: 10px;
            font-size: 1em;
            color: #0056b3;
            background-color: #f0f8ff;
            padding: 8px;
            border-radius: 4px;
            display: none;
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            height: 20px;
            margin-top: 20px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            border-radius: 5px;
            text-align: center;
            color: white;
            line-height: 20px;
            transition: width 0.5s ease-in-out;
        }
        sup, sub {
            vertical-align: super;
            font-size: smaller;
        }
        sub {
            vertical-align: sub;
        }
        .equation {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f0f0f0;
            padding: 8px;
            border-left: 4px solid #0056b3;
            margin-top: 10px;
            display: inline-block;
            overflow-x: auto;
            max-width: 100%; /* Ensure it fits in the box */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>آزمون حفظ کردن - شیمی و فیزیک</h1>
        <p>جواب را تایپ کرده و دکمه "بررسی جواب" را بزنید. وقتی سوالات تمام شد، دکمه "شروع مجدد" ظاهر می‌شود.</p>

        <div class="qa-box">
            <div id="questionDisplay" class="question-text">برای شروع، دکمه "سوال بعدی" را بزنید.</div>
            <input type="text" id="answerInput" placeholder="جواب خود را اینجا تایپ کنید">
            <div id="feedbackDisplay" class="feedback"></div>
            <div id="correctAnswerDisplay" class="correct-answer-display"></div>
        </div>

        <div class="buttons">
            <button id="checkAnswer">بررسی جواب</button>
            <button id="nextQuestion">سوال بعدی</button>
        </div>

        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar">0%</div>
        </div>
    </div>

    <script>
        const qaPairs = [
            { question: "نام Al<sub>2</sub>O<sub>3</sub> چیست؟", answer: "بوکسیت" },
            { question: "نام Fe<sub>2</sub>O<sub>3</sub> چیست؟", answer: "هماتیت" },
            { question: "تولیدات ذغال سنگ در هنگام احتراق چیست؟", answer: "CO, CO2, H2O, SO2" },
            { question: "اکسید فلز چه خاصیتی دارد؟", answer: "بازی است" },
            { question: "اکسید نافلز چه خاصیتی دارد؟", answer: "اسیدی است" },
            { question: "سرکه چند درصد استیک اسید دارد؟", answer: "پنج درصد" },
            { question: "کدام عنصر در شربت معده وجود دارد؟", answer: "منیزیم" },
            { question: "لیتیوم سولفات در آب چه خاصیتی دارد؟", answer: "گرماده است" },
            { question: "کدام ترکیبات در آب کم محلول هستند؟", answer: "نقره کلرید، باریم سولفات، کلسیم سولفات و منیزیم هیدروکسید" },
            { question: "فراوان‌ترین یون در آب چیست؟", answer: "Cl-" },
            { question: "معادله واکنش NaCl با AgNO<sub>3</sub> چیست؟ (با H<sub>2</sub>O به عنوان کاتالیزور)", answer: 'NaCl<sub>(s)</sub> + AgNO<sub>3(s)</sub> &rarr; AgCl<sub>(s)</sub> + NaNO<sub>3(aq)</sub>' },
            { question: "معادله واکنش 2Na<sub>3</sub>PO<sub>4</sub> با 3CaCl<sub>2</sub> چیست؟ (با H<sub>2</sub>O به عنوان کاتالیزور)", answer: '2Na<sub>3</sub>PO<sub>4(s)</sub> + 3CaCl<sub>2(s)</sub> &rarr; Ca<sub>3</sub>(PO<sub>4</sub>)<sub>2(s)</sub> + 6NaCl<sub>(aq)</sub>' },
            { question: "ترتیب امواج از قوی به ضعیف چیست؟", answer: "گاما، ایکس، فرابنفش، مرئی، فروسرخ، ریزموج‌ها، رادیویی" },
            { question: "وزن پروتون چقدر است؟", answer: "۱.۰۰۷۳" },
            { question: "وزن نوترون چقدر است؟", answer: "۱.۰۰۸۷" },
            { question: "حرکت الکترون از لایه ۶ به لایه ۲ چه رنگی می‌سازد؟", answer: "بنفش" },
            { question: "حرکت الکترون از لایه ۵ به لایه ۲ چه رنگی می‌سازد؟", answer: "آبی" },
            { question: "حرکت الکترون از لایه ۴ به لایه ۲ چه رنگی می‌سازد؟", answer: "سبز" },
            { question: "حرکت الکترون از لایه ۳ به لایه ۲ چه رنگی می‌سازد؟", answer: "قرمز" },
            { question: "کدام ایزوتوپ اورانیوم در راکتورها استفاده می‌شود؟", answer: "اورانیوم ۲۳۵" },
            { question: "درصد فراوانی اورانیوم ۲۳۵ در جرم طبیعی چقدر است؟", answer: "کمتر از ۰.۷ درصد" },
            { question: "چند عنصر ساختگی و چند عنصر طبیعی داریم؟", answer: "۲۶ عنصر ساختگی و ۹۲ طبیعی" },
            { question: "نام حلال رنگ چیست؟", answer: "هگزان" },
            { question: "هیدروژن با اتصال به چه عناصری پیوند هیدروژنی می‌سازد؟", answer: "F, N, O" },
            { question: "یون هیدروکسید (HO) چند بار منفی دارد؟", answer: "یک بار منفی" },
            { question: "یون آمونیوم (NH<sub>4</sub>) چند بار مثبت دارد؟", answer: "یک بار مثبت" },
            { question: "یون منگنات (MnO<sub>4</sub>) چند بار منفی دارد؟", answer: "دو بار منفی" },
            { question: "یون پرمنگنات (MnO<sub>4</sub>) چند بار منفی دارد؟", answer: "یک بار منفی" },
            { question: "یون کربنات (CO<sub>3</sub>) چند بار منفی دارد؟", answer: "دو بار منفی" },
            { question: "یون سولفات (SO<sub>4</sub>) چند بار منفی دارد؟", answer: "دو بار منفی" },
            { question: "یون نیترات (NO<sub>3</sub>) چند بار منفی دارد؟", answer: "یک بار منفی" },
            { question: "مراحل تهیه منیزیم از آب را شرح دهید.", answer: "برای تهیه منیزیم از آب، ابتدا به آن هیدروکسید (HO<sup>-</sup>) اضافه می‌کنیم تا به صورت Mg(OH)<sub>2</sub> دربیاید که نامحلول است. سپس به آن هیدروکلریک اسید می‌زنیم تا نمکی محلول در آب به دست آید. در نهایت، با عبور جریان برق (الکترولیز)، آن را از کلر جدا می‌کنیم." }
        ];

        let availableQuestions = [...qaPairs]; // Copy of all questions
        let askedQuestionsCount = 0;
        let currentQuestion = null;

        const questionDisplay = document.getElementById('questionDisplay');
        const answerInput = document.getElementById('answerInput');
        const feedbackDisplay = document.getElementById('feedbackDisplay');
        const correctAnswerDisplay = document.getElementById('correctAnswerDisplay');
        const checkAnswerBtn = document.getElementById('checkAnswer');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const progressBar = document.getElementById('progressBar');

        // Function to normalize strings for comparison (remove extra spaces, convert to lowercase)
        function normalizeString(str) {
            // Replace various spaces/newlines with a single space, trim, and convert to lowercase
            return str.replace(/\s+/g, ' ').trim().toLowerCase();
        }

        function displayNextQuestion() {
            if (availableQuestions.length === 0) {
                questionDisplay.innerHTML = 'تمام سوالات پاسخ داده شدند! 🥳';
                answerInput.style.display = 'none';
                checkAnswerBtn.style.display = 'none';
                nextQuestionBtn.textContent = 'شروع مجدد آزمون';
                feedbackDisplay.innerHTML = '';
                correctAnswerDisplay.style.display = 'none';
                return;
            }

            const randomIndex = Math.floor(Math.random() * availableQuestions.length);
            currentQuestion = availableQuestions.splice(randomIndex, 1)[0]; // Remove question from available
            
            questionDisplay.innerHTML = currentQuestion.question;
            answerInput.value = ''; // Clear previous input
            answerInput.style.display = 'block';
            feedbackDisplay.innerHTML = ''; // Clear feedback
            correctAnswerDisplay.style.display = 'none'; // Hide correct answer
            checkAnswerBtn.disabled = false; // Enable check button
            nextQuestionBtn.disabled = true; // Disable next button until checked
            answerInput.focus(); // Focus on the input field

            updateProgressBar();
        }

        function checkAnswer() {
            const userAnswer = normalizeString(answerInput.value);
            // We need to normalize the stored answer only when comparing it.
            // Some answers contain HTML tags like <sub> or equations, so we can't just call .textContent
            // We'll create a temporary div to get the plain text if it's not a simple string.
            let correctAnswerNormalized;
            if (currentQuestion.answer.includes('<')) { // Check if it likely contains HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = currentQuestion.answer;
                correctAnswerNormalized = normalizeString(tempDiv.textContent);
            } else {
                correctAnswerNormalized = normalizeString(currentQuestion.answer);
            }

            if (userAnswer === correctAnswerNormalized) {
                feedbackDisplay.innerHTML = 'درست بود! ✅';
                feedbackDisplay.className = 'feedback correct';
                correctAnswerDisplay.style.display = 'none';
                askedQuestionsCount++; // Increment count only on correct answer
                // Automatically move to next question if correct, or enable button
                nextQuestionBtn.disabled = false; 
                checkAnswerBtn.disabled = true; // Disable check after correct answer
                answerInput.disabled = true; // Disable input after correct answer
            } else {
                feedbackDisplay.innerHTML = 'اشتباه بود. ❌';
                feedbackDisplay.className = 'feedback incorrect';
                correctAnswerDisplay.innerHTML = 'پاسخ صحیح: ' + currentQuestion.answer;
                correctAnswerDisplay.style.display = 'block';
                checkAnswerBtn.disabled = true; // Disable check after incorrect answer
                nextQuestionBtn.disabled = false; // Enable next to allow skipping
                answerInput.disabled = true; // Disable input after incorrect answer
            }
            updateProgressBar();
        }

        function updateProgressBar() {
            const totalQuestions = qaPairs.length;
            const progress = ((totalQuestions - availableQuestions.length) / totalQuestions) * 100;
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';

            if (availableQuestions.length === 0) {
                progressBar.textContent = '۱۰۰%';
                progressBar.style.width = '100%';
            }
        }

        // Event Listeners
        checkAnswerBtn.addEventListener('click', checkAnswer);
        nextQuestionBtn.addEventListener('click', () => {
            if (availableQuestions.length === 0 && nextQuestionBtn.textContent === 'شروع مجدد آزمون') {
                // Reset quiz
                availableQuestions = [...qaPairs];
                askedQuestionsCount = 0;
                answerInput.style.display = 'block';
                checkAnswerBtn.style.display = 'inline-block';
                nextQuestionBtn.textContent = 'سوال بعدی';
                answerInput.disabled = false;
                displayNextQuestion();
            } else {
                answerInput.disabled = false; // Enable input for new question
                displayNextQuestion();
            }
        });

        // Allow pressing Enter to check answer
        answerInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' && !checkAnswerBtn.disabled) {
                checkAnswer();
            }
        });

        // Initial load
        displayNextQuestion();
    </script>
</body>
</html>
